
<div id="comments">
    <% 
    video.comments=video.comments.reverse();
    video.comments.forEach(function(comment){

  %>
  <div class="media mb-4">
    <img class="d-flex mr-3 comment-img" src="<%= comment.user.image %>" onerror="this.src= 'http://placehold.it/100*100'" >
    
    <div class="media-body">
        <h5 class="mt-0"><%= comment.user.name %></h5><%= comment.comment %>
        </div>
   </div>

<%}) %>
</div>
<% if(typeof isLogin !== "undefined" && isLogin){ %> 

    <div class="card my-4">
        <div class="card-header">
            Leave a comment:
        </div>

        <div class="card-body">
<form onsubmit="return postComment(this);">

<div class="form-group">
    <textarea name="comment"  class="form-control"></textarea>
</div>
<input type="submit"  class="btn btn-primary " value="Post comment">
</form>
        </div>
    </div>

<script type="text/javascript">

function createReplyNode(node){
    var commentId=node.getAttribute("data-comment-id");
    var html=""
    html+='<div class="row">';
        html+='<form onsubmit="return postReply(this);">';
            html+='<input type="hidden" name="commentId" value="' + commentId+ '">';
        

    html+='<div class="form-group">';
        html+='<label>Write Reply </label>';
        html=='<textarea class="form-control" name="reply"></textarea>'      ;
        html+='</div>'  ;

        html+='<button type="submit" class="btn btn-primary" data-comment-id="'+ commentId + '">Post</button>';

        html+='</form>';
        html+='</div>';
        html+='</div>';

        node.innerHTML=html;
        node.removeAttribute("onclick");
}


function postReply(form){
    var commentId=form.commentId.value;
    var reply=form.reply.value;

    var ajax=new XMLHttpRequest();
    ajax.open("POST","/do-reply",true);
    ajax.setRequestHeader("Content-Type","application/x-www-form-urlencoded");
    ajax.onreadystatechange=function(){
        if(this.status==200 && this.readyState==4){
            var response=JSON.parse(this.responseText);
            var html="";
            html+='<div class="media mt-4">';
               html+='<img class="d-flex mr-3 comment-img" src="' 
 + response.user.image +'" onerror="this.src=\'http://placehold.it/100*100 \'">';
  
 html+='<div class="media-body">';
    html+='<h5 class="mt-0">'+response.user.name + '</h5>';
    html+= form.reply.value;
    html+='</div>';
    html+='</div>';

    document.getElementById("replies").innerHTML+=html;
    form.reply.value="";

        }
    }

    ajax.send("commentId=" +commentId + "&reply=" + reply);
    return false;
}

function postComment(self){
    var ajax =new XMLHttpRequest();
    ajax.open("POST","/doComment",true);
    ajax.setRequestHeader("Content-Type","application/x-www-form-urlencoded");


    ajax.onreadystatechange = function(){
    if(this.readyState == 4 && this.status==200){
        var response=JSON.parse(this.responseText);

var html="";
html+='<div class="media mb-4">';
    html+='<img class="d-flex mr-3 comment-img" src="' + response.user.image + '" onerror="this.src =\'http://placehold.it/100*100\'">';
    
html+='<div class="media-body">';
    html+='<h5 class="mt-0">' +response.user.name+'</h5>';
    html+=self.comment.value;
    html+='</div>';
    html+='</div>';

    document.getElementById("comments").innerHTML= html + document.getElementById("comments").innerHTML;
    self.comment.value="";
    }
}

    
    var videoId=document.getElementById("videoId1").value;

    ajax.send("videoId=" + videoId + "&comment=" + self.comment.value);
    return false;
}

</script>



    <% } %>
